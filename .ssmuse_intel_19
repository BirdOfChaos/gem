#!/bin/bash

# Load compiler and libraries
# add a symbolic link for gem_dbase
# create build directory according to the compiler called

. r.load.dot /fs/ssm/hpco/exp/intelpsxe-cluster-19.0.3.199 rpn/base/01.0
. r.load.dot /fs/ssm/hpco/exp/openmpi/openmpi-3.1.2--hpcx-2.2.0--ofed-4.4.2--intel-2019.0.045

if [ `hostname -d` = "cmc.ec.gc.ca" ];
# in eccc network
then
    GEM_DBASE=/home/ordenv/ssm-domains9/release/gem-data_4.2.0/gem-data_4.2.0_all/share/data/dfiles;
    [ -e ${GEM_DBASE} ] && [ ! -e gem_dbase ] && ln -sf ${GEM_DBASE} gem_dbase;
else
  if [ `hostname -d` = "science.gc.ca" ];
  # in science network
  then
    GEM_DBASE=/fs/ssm/eccc/mrd/rpn/MIG/GEM/d/gem-data/gem-data_4.2.0/gem-data_4.2.0_all/share/data/dfiles;
    [ -e ${GEM_DBASE} ] && [ ! -e gem_dbase ] && ln -sf ${GEM_DBASE} gem_dbase;
  fi
fi

COMP_VERSION=`project/compiler.sh intel`
BUILD_DIR=build-intel-$COMP_VERSION
echo mkdir -p work/$BUILD_DIR
mkdir -p work/$BUILD_DIR

sed -i s"/.*cmake.buildDirectory.*/           \"cmake.buildDirectory\": \"\${workspaceRoot}\/$BUILD_DIR\",/" goas-devel.code-workspace
